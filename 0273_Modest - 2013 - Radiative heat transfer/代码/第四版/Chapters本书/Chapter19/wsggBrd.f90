!=========================================================================================
! Routine to recover WSGG parameter from Bordbar correlation of Eq. (20.92); converted from Matlab by M. Modest 5/2020
subroutine wsggBRd(T,p,pco2,ph2o,aa,kk)
! INPUT:
!          T:          Temperature T [K] 300-2400
!          pco2:       CO2 p in atm
!          ph2o:       H2O p in atm
!          P:          Total pressure (Pt) [atm]
!          L:          Path length (L) [m]
!
! OUTPUTS    wsgg paramaters from Bordbar correlation
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 DOUBLE PRECISION,PARAMETER ::  table1c(100)=(/ &
 7.4129560000d-1,-5.2444410000d-1, 5.8228600000d-1,-2.0969940000d-1, 2.4203120000d-2, &
-9.4126520000d-1, 2.7995770000d-1,-7.6723190000d-1, 3.2040270000d-1,-3.9101740000d-2, &
 8.5318660000d-1, 8.2307540000d-2, 5.2894300000d-1,-2.4684630000d-1, 3.1093960000d-2, &
-3.3428060000d-1, 1.4749870000d-1,-4.1606890000d-1, 1.6976270000d-1,-2.0406600000d-2, &
 4.3143620000d-2,-6.8862170000d-2, 1.1097730000d-1,-4.2086080000d-2, 4.9188170000d-3, &
 1.5520730000d-1,-4.8621170000d-1, 3.6680880000d-1,-1.0555080000d-1, 1.0585680000d-2, &
 6.7556480000d-1, 1.4092710000d+0,-1.3834490000d+0, 4.5752100000d-1,-5.0197600000d-2, &
-1.1253940000d+0,-5.9131990000d-1, 9.0854410000d-1,-3.3342010000d-1, 3.8423610000d-2, &
 6.0405430000d-1,-5.5338540000d-2,-1.7330140000d-1, 7.9160830000d-2,-9.8933570000d-3, &
-1.1054530000d-1, 4.6466340000d-2,-1.6129820000d-3,-3.5398350000d-3, 6.1212770000d-4, &
 2.5502420000d-1, 3.8054030000d-1,-4.2497090000d-1, 1.4294460000d-1,-1.5740750000d-2, &
-6.0654280000d-1, 3.4940240000d-1, 1.8535090000d-1,-1.0136940000d-1, 1.3024410000d-2, &
 8.1238550000d-1,-1.1020090000d+0, 4.0461780000d-1,-8.1182230000d-2, 6.2981010000d-3, &
-4.5322900000d-1, 6.7844750000d-1,-3.4326030000d-1, 8.8308830000d-2,-8.4152210000d-3, &
 8.6930930000d-2,-1.3069960000d-1, 7.4144640000d-2,-2.0292940000d-2, 2.0109690000d-3, &
-3.4519940000d-2, 2.6567260000d-1,-1.2253650000d-1, 3.0015080000d-2,-2.8205250000d-3, &
 4.1120460000d-1,-5.7283500000d-1, 2.9244900000d-1,-7.9807660000d-2, 7.9966030000d-3, &
-5.0559950000d-1, 4.5795590000d-1,-2.6164360000d-1, 7.6484130000d-2,-7.9083560000d-3, &
 2.3175090000d-1,-1.6567590000d-1, 1.0526080000d-1,-3.2193470000d-2, 3.3869650000d-3, &
-3.7549080000d-2, 2.2951930000d-2,-1.6004720000d-2, 5.0463180000d-3,-5.3643260000d-4/)

 DOUBLE PRECISION,PARAMETER ::  table1d(20)=(/ &
 3.4042880000d-2, 6.5230480000d-2,-4.6368520000d-2, 1.3868350000d-2,-1.4449930000d-3, &
 3.5094570000d-1, 7.4651380000d-1,-5.2930900000d-1, 1.5944230000d-1,-1.6632610000d-2, &
 4.5707400000d+0, 2.1680670000d+0,-1.4989010000d+0, 4.9171650000d-1,-5.4299900000d-2, &
 1.0981690000d+2,-5.0923590000d+1, 2.3432360000d+1,-5.1638920000d+0, 4.3938890000d-1/)

 DOUBLE PRECISION ::  b(4,5),c(4,5,5),d(4,5),T,Tr,Mr,ph2o,pco2,p,aa(0:4),kk(0:4),suma
 INTEGER		  :: i,j,k,Ngwsgg
Ngwsgg=4

do i=1,Ngwsgg
    do j=1,5
        do k=1,5
            c(i,j,k)=table1c(((i-1)*5+j-1)*5+k)
        enddo
    enddo
enddo

do i=1,Ngwsgg
    do k=1,5
        d(i,k)=table1d((i-1)*5+k)
    enddo
enddo

!%%%%%%%%%%%%%%%%%%%%%%%
Tr=T/1200;
Mr=ph2o/pco2;
!%%%%%%%%%%%%%%%%%%%%%%%%

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!%                    Calculation of "b" cefficients ( eq. 9)                  %
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

do i=1,Ngwsgg
    do j=1,5
        b(i,j)=0
        do k=1,5
            b(i,j)=b(i,j)+c(i,j,k)*Mr**(k-1)
        enddo
    enddo
enddo

!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!%                    Calculation of "a" factors ( eq. 8)                      %
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

suma=0.
do i=1,Ngwsgg
    aa(i)=0
    do j=1,5
        aa(i)=aa(i)+b(i,j)*Tr**(j-1)
    enddo
	suma=suma+aa(i)
enddo
aa(0)=1-suma
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!%                    Calculation of "k" cefficients ( eq. 10)                 %
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

do i=1,Ngwsgg
    kk(i)=0
    do k=1,5
        kk(i)=kk(i)+d(i,k)*Mr**(k-1)
    enddo
enddo
kk=kk*(ph2o+pco2)
kk(0)=0

return
end
