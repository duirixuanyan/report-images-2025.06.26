%**********************************************************************************
%
%                    A MATLAB FUNCTION WRITTEN BY HADI BORDBAR
%
%                     DEPARTMENT OF CIVIL ENGINEERING
%                       AALTO UNIVERSITY, FINLAND
%
% Discription: A Matlab function to calculate emissivity by WSGG model published in:
% Bordbar M.H., W?cel, G., Hyppänen T., 
% A Line by Line Based Weighted Sum of Gray Gases Model for Inhomogeneous CO2-H2O Mixture in Oxy-Fired Combustion
% Combustion and Flame, Vol. 161, no. 9, pp. 2435-2445, (2014). 
% https://doi.org/10.1016/j.combustflame.2014.03.013
%=========================================================================================
function [e, a, kk]=Bordbar_WSGG2014(T,xco2,xh2o,Pt,L)
% INPUT:    Temperature T [K] 300-2400
%           Mole fraction of CO2 (xco2) [0...1]
%           Mole fraction of H2O (xh2o) [0...1]
%           Total pressure (Pt) [atm]
%           Path length (L) [m]; optional if emissivity of a path is needed
%
% OUTPUTS    
%           Emissivity of the mixture [0....1] if needed (path length is
%           given in the inputs)
%           Gray gas absorption coefficients (kk_i) [atm ^-1 m^-1]
%           Weighting factors a_i
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

table1_c=zeros(20,5);
table1_c(:,:)=[7.4129560000e-001          -5.2444410000e-001          5.8228600000e-001          -2.0969940000e-001          2.4203120000e-002 
-9.4126520000e-001          2.7995770000e-001          -7.6723190000e-001          3.2040270000e-001          -3.9101740000e-002 
8.5318660000e-001          8.2307540000e-002          5.2894300000e-001          -2.4684630000e-001          3.1093960000e-002 
-3.3428060000e-001          1.4749870000e-001          -4.1606890000e-001          1.6976270000e-001          -2.0406600000e-002 
4.3143620000e-002          -6.8862170000e-002          1.1097730000e-001          -4.2086080000e-002          4.9188170000e-003 
1.5520730000e-001          -4.8621170000e-001          3.6680880000e-001          -1.0555080000e-001          1.0585680000e-002 
6.7556480000e-001          1.4092710000e+000          -1.3834490000e+000          4.5752100000e-001          -5.0197600000e-002 
-1.1253940000e+000          -5.9131990000e-001          9.0854410000e-001          -3.3342010000e-001          3.8423610000e-002 
6.0405430000e-001          -5.5338540000e-002          -1.7330140000e-001          7.9160830000e-002          -9.8933570000e-003 
-1.1054530000e-001          4.6466340000e-002          -1.6129820000e-003          -3.5398350000e-003          6.1212770000e-004 
2.5502420000e-001          3.8054030000e-001          -4.2497090000e-001          1.4294460000e-001          -1.5740750000e-002 
-6.0654280000e-001          3.4940240000e-001          1.8535090000e-001          -1.0136940000e-001          1.3024410000e-002 
8.1238550000e-001          -1.1020090000e+000          4.0461780000e-001          -8.1182230000e-002          6.2981010000e-003 
-4.5322900000e-001          6.7844750000e-001          -3.4326030000e-001          8.8308830000e-002          -8.4152210000e-003 
8.6930930000e-002          -1.3069960000e-001          7.4144640000e-002          -2.0292940000e-002          2.0109690000e-003
-3.4519940000e-002          2.6567260000e-001          -1.2253650000e-001          3.0015080000e-002          -2.8205250000e-003 
4.1120460000e-001          -5.7283500000e-001          2.9244900000e-001          -7.9807660000e-002          7.9966030000e-003 
-5.0559950000e-001          4.5795590000e-001          -2.6164360000e-001          7.6484130000e-002          -7.9083560000e-003 
2.3175090000e-001          -1.6567590000e-001          1.0526080000e-001          -3.2193470000e-002          3.3869650000e-003 
-3.7549080000e-002          2.2951930000e-002          -1.6004720000e-002          5.0463180000e-003          -5.3643260000e-004]; 

table1_d=zeros(4,5);
table1_d(:,:)=[3.4042880000e-002          6.5230480000e-002          -4.6368520000e-002          1.3868350000e-002          -1.4449930000e-003
 3.5094570000e-001          7.4651380000e-001          -5.2930900000e-001          1.5944230000e-001          -1.6632610000e-002
 4.5707400000e+000          2.1680670000e+000          -1.4989010000e+000          4.9171650000e-001          -5.4299900000e-002
 1.0981690000e+002          -5.0923590000e+001          2.3432360000e+001          -5.1638920000e+000          4.3938890000e-001];


for i=1:4
    for j=1:5
        for k=1:5
        c(i,j,k)=table1_c(((i-1)*5+j),(k));
        end
    end
end

for i=1:4
    for k=1:5
        d(i,k)=table1_d(i,k);
    end
end

%%%%%%%%%%%%%%%%%%%%%%%%
Tr=T/1200;
Mr=xh2o/xco2;
%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                    Calculation of "b" cefficients ( eq. 9)                  %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

for i=1:4
    for j=1:5
        b(i,j)=0;
        for k=1:5
            b(i,j)=b(i,j)+c(i,j,k)*Mr^(k-1);
        end
    end
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                    Calculation of "a" factors ( eq. 8)                      %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

for i=1:4
    a(i)=0;
    for j=1:5
        a(i)=a(i)+b(i,j)*Tr^(j-1);
    end
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                    Calculation of "k" cefficients ( eq. 10)                 %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

for i=1:4
    kk(i)=0;
    for k=1:5
        kk(i)=kk(i)+d(i,k)*Mr^(k-1);
    end
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                    Calculation of total emissivity(eq. 5)                   %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

e=0;
if (nargin == 5) % only if emissivity of a path is needed
    PtL=(xh2o+xco2)*Pt*L;
    for i=1:4
        e=e+a(i)*(1-exp(-kk(i)*PtL));
    end
end



